// Code generated by eugene. DO NOT EDIT.
package {{ .Package }}

import (
	"encoding/json"
	"net/http"
{{- if .HasQueryParams }}
	"strconv"
{{- end }}
{{- if .TimeImport }}
	"time"
{{- end }}

	"github.com/go-chi/chi/v5"
{{- if .UUIDImport }}
	"{{ .UUIDImport }}"
{{- end }}
)
{{- if .HasQueryString }}

func decodeQueryString(r *http.Request, v any) error {
	data := make(map[string]any)
	for key, values := range r.URL.Query() {
		if len(values) == 1 {
			data[key] = values[0]
		} else {
			data[key] = values
		}
	}
	b, err := json.Marshal(data)
	if err != nil {
		return err
	}
	return json.Unmarshal(b, v)
}
{{- end }}

// StrictChiHandler wraps a StrictServerInterface to handle Chi requests.
type StrictChiHandler struct {
	ssi StrictServerInterface
}

// NewStrictHandler creates a new StrictChiHandler.
func NewStrictHandler(ssi StrictServerInterface) *StrictChiHandler {
	return &StrictChiHandler{ssi: ssi}
}
{{ range .Operations }}
// {{ .ID }} handles {{ .Method }} {{ .Path }}
func (h *StrictChiHandler) {{ .ID }}(w http.ResponseWriter, r *http.Request) {
{{- if or .PathParams .QueryParams .HeaderParams .QueryString .RequestBody }}
	var request {{ .ID }}RequestObject
{{- end }}
{{- range .PathParams }}
{{- if eq .Type "uuid.UUID" }}
	if parsed, err := uuid.Parse(chi.URLParam(r, "{{ .Name }}")); err != nil {
		http.Error(w, "invalid {{ .Name }}", http.StatusBadRequest)
		return
	} else {
		request.{{ .GoName }} = parsed
	}
{{- else }}
	request.{{ .GoName }} = chi.URLParam(r, "{{ .Name }}")
{{- end }}
{{- end }}
{{- range .QueryParams }}
{{- if hasPrefix .Type "[]" }}
	if values := r.URL.Query()["{{ .Name }}"]; len(values) > 0 {
		{{ if .Required }}request.{{ .GoName }} = values{{ else }}request.{{ .GoName }} = &values{{ end }}
	}
{{- else if eq .Type "string" }}
	if v := r.URL.Query().Get("{{ .Name }}"); v != "" {
		request.{{ .GoName }} = {{ if not .Required }}&{{ end }}v
	}
{{- else if eq .Type "int" }}
	if v := r.URL.Query().Get("{{ .Name }}"); v != "" {
		if parsed, err := strconv.Atoi(v); err == nil {
			{{ if .Required }}request.{{ .GoName }} = parsed{{ else }}request.{{ .GoName }} = &parsed{{ end }}
		}
	}
{{- else if eq .Type "int64" }}
	if v := r.URL.Query().Get("{{ .Name }}"); v != "" {
		if parsed, err := strconv.ParseInt(v, 10, 64); err == nil {
			{{ if .Required }}request.{{ .GoName }} = parsed{{ else }}request.{{ .GoName }} = &parsed{{ end }}
		}
	}
{{- else if eq .Type "bool" }}
	if v := r.URL.Query().Get("{{ .Name }}"); v != "" {
		if parsed, err := strconv.ParseBool(v); err == nil {
			{{ if .Required }}request.{{ .GoName }} = parsed{{ else }}request.{{ .GoName }} = &parsed{{ end }}
		}
	}
{{- else if eq .Type "uuid.UUID" }}
	if v := r.URL.Query().Get("{{ .Name }}"); v != "" {
		if parsed, err := uuid.Parse(v); err == nil {
			{{ if .Required }}request.{{ .GoName }} = parsed{{ else }}request.{{ .GoName }} = &parsed{{ end }}
		}
	}
{{- else }}
	if v := r.URL.Query().Get("{{ .Name }}"); v != "" {
		{{ if .Required }}typed := {{ .Type }}(v)
		request.{{ .GoName }} = typed{{ else }}typed := {{ .Type }}(v)
		request.{{ .GoName }} = &typed{{ end }}
	}
{{- end }}
{{- end }}
{{- range .HeaderParams }}
	if v := r.Header.Get("{{ .Name }}"); v != "" {
		request.{{ .GoName }} = {{ if not .Required }}&{{ end }}v
	}
{{- end }}
{{- if .QueryString }}
	if err := decodeQueryString(r, &request.{{ .QueryString.GoName }}); err != nil {
		http.Error(w, "invalid querystring", http.StatusBadRequest)
		return
	}
{{- end }}
{{- if .RequestBody }}
	{{ if .RequestBody.Required }}var body {{ .RequestBody.Type }}
	if err := json.NewDecoder(r.Body).Decode(&body); err != nil {
		http.Error(w, err.Error(), http.StatusBadRequest)
		return
	}
	request.Body = body{{ else }}var body {{ .RequestBody.Type }}
	if err := json.NewDecoder(r.Body).Decode(&body); err == nil {
		request.Body = &body
	}{{ end }}
{{- end }}

	response, err := h.ssi.{{ .ID }}(r.Context(){{ if or .PathParams .QueryParams .HeaderParams .QueryString .RequestBody }}, request{{ end }})
	if err != nil {
		http.Error(w, err.Error(), http.StatusInternalServerError)
		return
	}

	if err := response.Visit{{ .ID }}ResponseObject(w); err != nil {
		http.Error(w, err.Error(), http.StatusInternalServerError)
	}
}
{{ end }}
// RegisterStrictHandlers registers all strict handlers with the Chi router.
func RegisterStrictHandlers(r chi.Router, ssi StrictServerInterface) {
	h := NewStrictHandler(ssi)
{{ range .Operations }}
	r.Method("{{ .Method }}", "{{ .FramePath }}", http.HandlerFunc(h.{{ .ID }}))
{{- end }}
}
