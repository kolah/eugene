// Code generated by eugene. DO NOT EDIT.
package {{ .Package }}
{{ if or .NeedsTime .NeedsJSON .UUIDImport .UseNullable .ExtensionImports .MappedImports }}
import (
{{- if .NeedsTime }}
	"time"
{{- end }}
{{- if .NeedsJSON }}
	"encoding/json"
	"fmt"
{{- end }}
{{- if .UUIDImport }}
	"{{ .UUIDImport }}"
{{- end }}
{{- if .UseNullable }}
	"github.com/oapi-codegen/nullable"
{{- end }}
{{- range .ExtensionImports }}
	{{ if .Alias }}{{ .Alias }} {{ end }}"{{ .Path }}"
{{- end }}
{{- range .MappedImports }}
	"{{ . }}"
{{- end }}
)
{{ end }}
{{- /* Generate top-level schemas */ -}}
{{- range .Schemas }}
{{- if not (isComposition .) }}
{{ if .Description }}{{ goComment .Description }}
{{ end -}}
{{- $extType := goTypeExt . -}}
{{- if and $extType (not .Enum) -}}
type {{ pascalCase .Name }} {{ $extType }}
{{- else -}}
type {{ pascalCase .Name }} {{ template "schemaType" dict "Schema" . "Required" .Required "EnumStrategy" $.EnumStrategy "EnableYAML" $.EnableYAMLTags }}
{{- end }}
{{- end }}
{{ end }}
{{- /* Generate nested types */ -}}
{{- range .NestedTypes }}
{{- if .IsUnion }}
{{ template "unionType" dict "Type" . "EnumStrategy" $.EnumStrategy }}
{{- else if .IsAllOf }}
{{ template "allOfType" dict "Type" . "EnableYAML" $.EnableYAMLTags }}
{{- else if .IsEnum }}
{{ template "nestedEnumType" dict "Type" . "EnumStrategy" $.EnumStrategy }}
{{- else }}
{{ template "nestedStructType" dict "Type" . "EnumStrategy" $.EnumStrategy "EnableYAML" $.EnableYAMLTags }}
{{- end }}
{{- end }}
{{- /* Generate enum constants */ -}}
{{- range .Schemas }}
{{- if .Enum }}
{{ template "enumConsts" dict "Schema" . "EnumStrategy" $.EnumStrategy }}
{{- end }}
{{- end }}
{{- /* schemaType template */ -}}
{{- define "schemaType" -}}
{{- $s := .Schema -}}
{{- $yaml := .EnableYAML -}}
{{- if $s.Enum -}}
{{ template "enumType" dict "Schema" $s "EnumStrategy" .EnumStrategy }}
{{- else if eq $s.Type "object" -}}
struct {
{{- range $s.Properties }}
	{{- $baseType := goTypeExt .Schema }}
	{{- if not $baseType }}{{ $baseType = resolveType .Schema $s.Name .Name }}{{ end }}
	{{ goNameExt .Schema .Name }} {{ if needsPointer .Schema $s.Required }}{{ nullableType $baseType }}{{ else }}{{ $baseType }}{{ end }} {{ structTagYAML .Schema .Name (isRequired .Name $s.Required) $yaml }}
{{- end }}
}
{{- else if eq $s.Type "array" -}}
[]{{ resolveType $s.Items $s.Name "Item" }}
{{- else -}}
{{ resolveType $s "" "" }}
{{- end -}}
{{- end -}}
{{- /* enumType template */ -}}
{{- define "enumType" -}}
{{- $s := .Schema -}}
{{- if eq .EnumStrategy "struct" -}}
struct {
	value {{ goBaseType $s }}
}
{{- else -}}
{{ goBaseType $s }}
{{- end -}}
{{- end -}}
{{- /* enumConsts template */ -}}
{{- define "enumConsts" -}}
{{- $s := .Schema -}}
{{- $name := pascalCase $s.Name -}}
{{- if eq .EnumStrategy "struct" }}
func (e {{ $name }}) String() string { return fmt.Sprintf("%v", e.value) }
func (e {{ $name }}) Value() {{ goBaseType $s }} { return e.value }
func (e {{ $name }}) IsValid() bool {
	switch e.value {
	{{- range $s.Enum }}
	case {{ enumLiteral $s . }}:
		return true
	{{- end }}
	}
	return false
}

func (e {{ $name }}) MarshalJSON() ([]byte, error) {
	return json.Marshal(e.value)
}

func (e *{{ $name }}) UnmarshalJSON(data []byte) error {
	return json.Unmarshal(data, &e.value)
}

var (
{{- range $i, $v := $s.Enum }}
	{{ $name }}{{ pascalCase (printf "%v" $v) }} = {{ $name }}{value: {{ enumLiteral $s $v }}}
{{- end }}
)
{{- else }}
const (
{{- range $i, $v := $s.Enum }}
	{{ $name }}{{ pascalCase (printf "%v" $v) }} {{ $name }} = {{ enumLiteral $s $v }}
{{- end }}
)
{{- end }}
{{- end -}}
{{- /* unionType template - generates json.RawMessage based union */ -}}
{{- define "unionType" -}}
{{- $t := .Type -}}
{{- $name := $t.Name -}}
{{- $disc := $t.Discriminator -}}
type {{ $name }} struct {
	Type string          `json:"-"`
	Raw  json.RawMessage `json:"-"`
}

func (u *{{ $name }}) UnmarshalJSON(data []byte) error {
{{- if $disc }}
	var d struct {
		{{ pascalCase $disc.PropertyName }} string `json:"{{ $disc.PropertyName }}"`
	}
	if err := json.Unmarshal(data, &d); err != nil {
		return err
	}
	u.Type = d.{{ pascalCase $disc.PropertyName }}
{{- else }}
	u.Type = ""
{{- end }}
	u.Raw = data
	return nil
}

func (u {{ $name }}) MarshalJSON() ([]byte, error) {
	return u.Raw, nil
}
{{- range $t.Variants }}

func (u *{{ $name }}) As{{ .TypeName }}() (*{{ .TypeName }}, error) {
{{- if and $disc .DiscValue }}
	if u.Type != {{ printf "%q" .DiscValue }} {
		return nil, fmt.Errorf("not a {{ .TypeName }}, type is %s", u.Type)
	}
{{- end }}
	var v {{ .TypeName }}
	if err := json.Unmarshal(u.Raw, &v); err != nil {
		return nil, err
	}
	return &v, nil
}
{{- end }}
{{- end -}}
{{- /* allOfType template - generates embedded structs */ -}}
{{- define "allOfType" -}}
{{- $t := .Type -}}
{{- $s := $t.Schema -}}
{{- $yaml := .EnableYAML -}}
type {{ $t.Name }} struct {
{{- range $s.AllOf }}
{{- if .Ref }}
	{{ refToTypeName .Ref }}
{{- end }}
{{- end }}
{{- range $s.Properties }}
	{{- $baseType := goTypeExt .Schema }}
	{{- if not $baseType }}{{ $baseType = resolveType .Schema $t.Name .Name }}{{ end }}
	{{ goNameExt .Schema .Name }} {{ if needsPointer .Schema $s.Required }}{{ nullableType $baseType }}{{ else }}{{ $baseType }}{{ end }} {{ structTagYAML .Schema .Name (isRequired .Name $s.Required) $yaml }}
{{- end }}
}
{{- end -}}
{{- /* nestedStructType template */ -}}
{{- define "nestedStructType" -}}
{{- $t := .Type -}}
{{- $s := $t.Schema -}}
{{- $yaml := .EnableYAML -}}
{{ if $s.Description }}{{ goComment $s.Description }}
{{ end -}}
type {{ $t.Name }} struct {
{{- range $s.Properties }}
	{{- $baseType := goTypeExt .Schema }}
	{{- if not $baseType }}{{ $baseType = resolveType .Schema $t.Name .Name }}{{ end }}
	{{ goNameExt .Schema .Name }} {{ if needsPointer .Schema $s.Required }}{{ nullableType $baseType }}{{ else }}{{ $baseType }}{{ end }} {{ structTagYAML .Schema .Name (isRequired .Name $s.Required) $yaml }}
{{- end }}
}
{{- end -}}
{{- /* nestedEnumType template - generates type and constants for inline enums */ -}}
{{- define "nestedEnumType" -}}
{{- $t := .Type -}}
{{- $s := $t.Schema -}}
{{ if $s.Description }}{{ goComment $s.Description }}
{{ end -}}
type {{ $t.Name }} {{ template "enumType" dict "Schema" $s "EnumStrategy" .EnumStrategy }}
{{ template "enumConsts" dict "Schema" $s "EnumStrategy" .EnumStrategy }}
{{- end -}}
