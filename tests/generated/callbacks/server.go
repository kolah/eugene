// Code generated by eugene. DO NOT EDIT.
package gen

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"net/http"

	"github.com/labstack/echo/v4"
)

type ServerInterface interface {
	// CreateOrder
	CreateOrder(ctx echo.Context) error
}

type ServerInterfaceWrapper struct {
	Handler ServerInterface
}

func (w *ServerInterfaceWrapper) CreateOrder(ctx echo.Context) error {
	return w.Handler.CreateOrder(ctx)
}

func RegisterHandlers(e *echo.Echo, si ServerInterface) {
	wrapper := &ServerInterfaceWrapper{Handler: si}

	e.POST("/orders", wrapper.CreateOrder)
}

func RegisterHandlersWithBaseURL(e *echo.Echo, si ServerInterface, baseURL string) {
	wrapper := &ServerInterfaceWrapper{Handler: si}
	g := e.Group(baseURL)

	g.POST("/orders", wrapper.CreateOrder)
}

// CallbackServerInterface handles incoming callback requests.
// Implement this interface for webhook endpoints that receive callbacks.
type CallbackServerInterface interface {
	// OrderProcessed handles the orderProcessed callback
	OrderProcessed(ctx echo.Context) error
}

type CallbackServerInterfaceWrapper struct {
	Handler CallbackServerInterface
}

func (w *CallbackServerInterfaceWrapper) OrderProcessed(ctx echo.Context) error {
	return w.Handler.OrderProcessed(ctx)
}

func RegisterCallbackHandlers(e *echo.Echo, si CallbackServerInterface, basePath string) {
	wrapper := &CallbackServerInterfaceWrapper{Handler: si}
	g := e.Group(basePath)
	g.POST("", wrapper.OrderProcessed)
}

// CallbackClient makes outgoing callback HTTP requests.
// Use this from your server implementation to send callbacks.
type CallbackClient struct {
	client *http.Client
}

func NewCallbackClient(client *http.Client) *CallbackClient {
	if client == nil {
		client = http.DefaultClient
	}
	return &CallbackClient{client: client}
}

// OrderProcessed sends the orderProcessed callback to the specified URL.
func (c *CallbackClient) OrderProcessed(ctx context.Context, callbackURL string, body OrderCallback) error {
	data, err := json.Marshal(body)
	if err != nil {
		return err
	}
	req, err := http.NewRequestWithContext(ctx, "POST", callbackURL, bytes.NewReader(data))
	if err != nil {
		return err
	}
	req.Header.Set("Content-Type", "application/json")
	resp, err := c.client.Do(req)
	if err != nil {
		return err
	}
	defer resp.Body.Close()
	if resp.StatusCode >= 400 {
		return fmt.Errorf("callback failed with status %d", resp.StatusCode)
	}
	return nil
}
